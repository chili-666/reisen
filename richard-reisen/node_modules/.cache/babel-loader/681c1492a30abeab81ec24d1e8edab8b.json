{"ast":null,"code":"import _regeneratorRuntime from \"/home/chili_666/projects/reisen/richard-reisen/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/chili_666/projects/reisen/richard-reisen/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/home/chili_666/projects/reisen/richard-reisen/src/components/MeinKonto.js\";\nimport React from \"react\";\nimport BookingDetails from \"./booking/BookingDetails\";\nimport AccountAdress from \"./account/AccountAdress\";\nimport Companion from \"./booking/Companions\";\nimport BookingAddServices from \"./booking/BookingAddServices\";\nimport BookingButton from \"./booking/BookingButton\";\nimport { getToken } from \"./utils\";\nimport Cookie from \"js-cookie\";\nimport Strapi from \"strapi-sdk-javascript/build/main\";\nconst apiUrl = 'https://strapi.luis-backt-und-kocht.de'; //const apiUrl = `${process.env.REACT_APP_BACKEND_URL}`\n\nconst strapi = new Strapi(apiUrl); //console.log(\"URL\", apiUrl)\n//console.log(\"strapi\", strapi+'/graphql'\n\nclass MeinKonto extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      companions: false,\n      accountKeys: [],\n      token: \"\",\n      user: null\n    };\n  }\n\n  componentDidMount() {\n    var _this = this;\n\n    this.setState({\n      token: Cookie.get('jwt')\n    });\n\n    if (this.state.token) {\n      // authenticate the token on the server and place set user object\n      fetch('https://strapi.luis-backt-und-kocht.de/users/me', {\n        headers: {\n          Authorization: \"Bearer \".concat(this.state.token)\n        }\n      }).then( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(res) {\n          var user;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                if (res.ok) {\n                  _context.next = 4;\n                  break;\n                }\n\n                Cookie.remove(\"token\");\n\n                _this.setState({\n                  user: null\n                });\n\n                return _context.abrupt(\"return\", null);\n\n              case 4:\n                _context.next = 6;\n                return res.json();\n\n              case 6:\n                user = _context.sent;\n\n                _this.setUser(user);\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 54,\n        columnNumber: 13\n      }\n    }, \"Mein Konto\");\n  }\n\n}\n\nexport default MeinKonto;","map":{"version":3,"sources":["/home/chili_666/projects/reisen/richard-reisen/src/components/MeinKonto.js"],"names":["React","BookingDetails","AccountAdress","Companion","BookingAddServices","BookingButton","getToken","Cookie","Strapi","apiUrl","strapi","MeinKonto","Component","constructor","state","companions","accountKeys","token","user","componentDidMount","setState","get","fetch","headers","Authorization","then","res","ok","remove","json","setUser","render"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,cAAP,MAA2B,0BAA3B;AACA,OAAOC,aAAP,MAA0B,yBAA1B;AACA,OAAOC,SAAP,MAAsB,sBAAtB;AACA,OAAOC,kBAAP,MAA+B,8BAA/B;AACA,OAAOC,aAAP,MAA0B,yBAA1B;AACA,SAAQC,QAAR,QAAuB,SAAvB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAOC,MAAP,MAAmB,kCAAnB;AAGA,MAAMC,MAAM,GAAE,wCAAd,C,CACA;;AACA,MAAMC,MAAM,GAAG,IAAIF,MAAJ,CAAWC,MAAX,CAAf,C,CACA;AACA;;AAEA,MAAME,SAAN,SAAwBX,KAAK,CAACY,SAA9B,CAAwC;AACrCC,EAAAA,WAAW,GAAG;AACT;AADS,SAGbC,KAHa,GAGL;AACJC,MAAAA,UAAU,EAAE,KADR;AAEJC,MAAAA,WAAW,EAAE,EAFT;AAGJC,MAAAA,KAAK,EAAC,EAHF;AAIJC,MAAAA,IAAI,EAAE;AAJF,KAHK;AAEZ;;AAQDC,EAAAA,iBAAiB,GAAG;AAAA;;AAChB,SAAKC,QAAL,CAAc;AACVH,MAAAA,KAAK,EAAEV,MAAM,CAACc,GAAP,CAAW,KAAX;AADG,KAAd;;AAGA,QAAI,KAAKP,KAAL,CAAWG,KAAf,EAAsB;AAClB;AACAK,MAAAA,KAAK,CAAC,iDAAD,EAAoD;AACvDC,QAAAA,OAAO,EAAE;AACPC,UAAAA,aAAa,mBAAY,KAAKV,KAAL,CAAWG,KAAvB;AADN;AAD8C,OAApD,CAAL,CAIGQ,IAJH;AAAA,4EAIQ,iBAAOC,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA,oBAGCA,GAAG,CAACC,EAHL;AAAA;AAAA;AAAA;;AAIFpB,gBAAAA,MAAM,CAACqB,MAAP,CAAc,OAAd;;AACA,gBAAA,KAAI,CAACR,QAAL,CAAc;AAAEF,kBAAAA,IAAI,EAAE;AAAR,iBAAd;;AALE,iDAMK,IANL;;AAAA;AAAA;AAAA,uBAQeQ,GAAG,CAACG,IAAJ,EARf;;AAAA;AAQEX,gBAAAA,IARF;;AASJ,gBAAA,KAAI,CAACY,OAAL,CAAaZ,IAAb;;AATI;AAAA;AAAA;AAAA;AAAA;AAAA,SAJR;;AAAA;AAAA;AAAA;AAAA;AAeP;AACJ;;AAECa,EAAAA,MAAM,GAAG;AACN,wBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAP;AACF;;AArCqC;;AAwCxC,eAAepB,SAAf","sourcesContent":["import React from \"react\"\nimport BookingDetails from \"./booking/BookingDetails\"\nimport AccountAdress from \"./account/AccountAdress\"\nimport Companion from \"./booking/Companions\"\nimport BookingAddServices from \"./booking/BookingAddServices\"\nimport BookingButton from \"./booking/BookingButton\"\nimport {getToken} from \"./utils\"\nimport Cookie from \"js-cookie\";\nimport Strapi from \"strapi-sdk-javascript/build/main\"\n\n\nconst apiUrl= 'https://strapi.luis-backt-und-kocht.de';\n//const apiUrl = `${process.env.REACT_APP_BACKEND_URL}`\nconst strapi = new Strapi(apiUrl);\n//console.log(\"URL\", apiUrl)\n//console.log(\"strapi\", strapi+'/graphql'\n\nclass MeinKonto extends React.Component {\n   constructor() {\n        super()\n    }\n    state = {\n        companions: false,\n        accountKeys: [],\n        token:\"\",\n        user: null\n    }\n  \n    componentDidMount() {\n        this.setState({\n            token: Cookie.get('jwt') \n        })\n        if (this.state.token) {\n            // authenticate the token on the server and place set user object\n            fetch('https://strapi.luis-backt-und-kocht.de/users/me', {\n              headers: {\n                Authorization: `Bearer ${this.state.token}`,\n              },\n            }).then(async (res) => {\n                // if res comes back not valid, token is not valid\n                // delete the token and log the user out on client\n                if (!res.ok) {\n                  Cookie.remove(\"token\");\n                  this.setState({ user: null });\n                  return null;\n                }\n                const user = await res.json();\n                this.setUser(user);\n              });\n    }\n}\n\n  render() {\n     return <h1>Mein Konto</h1>\n  }\n}\n\nexport default MeinKonto"]},"metadata":{},"sourceType":"module"}